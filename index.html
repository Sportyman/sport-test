<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Timer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="clock">30</div>
    <input type="text" id="time-input" placeholder="Enter time in seconds">
    <input type="color" id="color-input">
    <button id="start-button">Start</button>
    <button id="pause-button">Pause</button>
    <button id="resume-button">Resume</button>
    <button id="reset-button">Reset</button>
    <button id="mute-button">Mute</button>
    <button id="log-button">Show/Hide Log</button>
    <button onclick="signIn()">Sign In with Google</button>
    <button onclick="signOut()">Sign Out</button>
    <div id="user-info"></div>
    <div id="calendar" style="display: none;">
        <h3>Workout Log</h3>
        <ul id="log-list"></ul>
    </div>
    <div>
        <h3>Stopwatch</h3>
        <div id="stopwatch">0:00</div>
        <button id="start-stopwatch">Start Stopwatch</button>
        <button id="stop-stopwatch">Stop Stopwatch</button>
        <button id="reset-stopwatch">Reset Stopwatch</button>
    </div>
    <canvas id="progress-chart" width="400" height="200"></canvas>
    
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut as firebaseSignOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD7Et0_VEScTKrHIwX1uFsRZY543Cx7gYY",
            authDomain: "sporty-clock.firebaseapp.com",
            projectId: "sporty-clock",
            storageBucket: "sporty-clock.appspot.com",
            messagingSenderId: "235575281192",
            appId: "1:235575281192:web:0b6a3e25a44147a7d0971d",
            measurementId: "G-3H955LDFN4"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Google Authentication
        async function signIn() {
            const provider = new GoogleAuthProvider();
            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                document.getElementById('user-info').textContent = `Hello, ${user.displayName}`;
                fetchLogs(user.uid);
            } catch (error) {
                console.error('Error during sign-in:', error);
            }
        }

        async function signOut() {
            try {
                await firebaseSignOut(auth);
                document.getElementById('user-info').textContent = '';
            } catch (error) {
                console.error('Error during sign-out:', error);
            }
        }

        // Firestore functions
        async function saveLog(uid, duration, category) {
            try {
                await addDoc(collection(db, 'workoutLogs'), {
                    uid,
                    duration,
                    category,
                    date: new Date().toISOString()
                });
                console.log('Log saved');
                fetchLogs(uid);
            } catch (error) {
                console.error('Error saving log:', error);
            }
        }

        async function fetchLogs(uid) {
            try {
                const q = query(collection(db, 'workoutLogs'), where('uid', '==', uid));
                const querySnapshot = await getDocs(q);
                const logList = document.getElementById('log-list');
                logList.innerHTML = '';
                querySnapshot.forEach((doc) => {
                    const log = doc.data();
                    const logItem = document.createElement('li');
                    logItem.textContent = `Date: ${new Date(log.date).toLocaleString()}, Duration: ${log.duration} seconds, Category: ${log.category}`;
                    logList.appendChild(logItem);
                });
            } catch (error) {
                console.error('Error fetching logs:', error);
            }
        }

        // Countdown Timer
        let countdownInterval;
        let remainingTime;
        let isPaused = false;

        function updateTabTitle(time) {
            document.title = `Time: ${time}s`;
        }

        document.getElementById('start-button').addEventListener('click', () => {
            const inputTime = parseInt(document.getElementById('time-input').value) || 30;
            startTimer(inputTime);
        });

        document.getElementById('pause-button').addEventListener('click', () => {
            pauseTimer();
        });

        document.getElementById('resume-button').addEventListener('click', () => {
            resumeTimer();
        });

        document.getElementById('reset-button').addEventListener('click', () => {
            resetTimer();
        });

        function startTimer(duration) {
            clearInterval(countdownInterval);
            remainingTime = duration;
            updateClock();
            countdownInterval = setInterval(() => {
                if (!isPaused) {
                    remainingTime--;
                    updateClock();
                    updateTabTitle(remainingTime);
                    if (remainingTime <= 0) {
                        clearInterval(countdownInterval);
                        playSound();
                        saveLog(auth.currentUser.uid, duration, 'default');
                    }
                }
            }, 1000);
        }

        function pauseTimer() {
            isPaused = true;
        }

        function resumeTimer() {
            isPaused = false;
        }

        function resetTimer() {
            clearInterval(countdownInterval);
            document.getElementById('clock').textContent = '30';
            updateTabTitle(30);
        }

        function updateClock() {
            document.getElementById('clock').textContent = remainingTime;
        }

        // Sound Notification
        let isMuted = false;
        const sounds = ['sounds/1.mp3', 'sounds/2.mp3', 'sounds/3.mp3', 'sounds/4.mp3', 'sounds/5.mp3', 'sounds/6.wav'];

        document.getElementById('mute-button').addEventListener('click', () => {
            isMuted = !isMuted;
        });

        function playSound() {
            if (!isMuted) {
                const audio = new Audio(sounds[Math.floor(Math.random() * sounds.length)]);
                audio.play();
            }
        }

        // Stopwatch Feature
        let stopwatchInterval;
        let stopwatchTime = 0;

        document.getElementById('start-stopwatch').addEventListener('click', () => {
            startStopwatch();
        });

        document.getElementById('stop-stopwatch').addEventListener('click', () => {
            stopStopwatch();
        });

        document.getElementById('reset-stopwatch').addEventListener('click', () => {
            resetStopwatch();
        });

        function startStopwatch() {
            clearInterval(stopwatchInterval);
            stopwatchInterval = setInterval(() => {
                stopwatchTime++;
                updateStopwatch();
            }, 1000);
        }

        function stopStopwatch() {
            clearInterval(stopwatchInterval);
        }

        function resetStopwatch() {
            clearInterval(stopwatchInterval);
            stopwatchTime = 0;
            updateStopwatch();
        }

        function updateStopwatch() {
            const minutes = Math.floor(stopwatchTime / 60);
            const seconds = stopwatchTime % 60;
            document.getElementById('stopwatch').textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }
    </script>
    <script src="script.js" type="module"></script>
</body>
</html>
